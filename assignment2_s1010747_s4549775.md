---
title: Assignment 2
author:
  - Hendrik Werner s4549775
  - Aniek Den Teuling s1010747
date: \today
fontsize: 12pt
geometry: margin=5em
---

# 1
## a
The 8 registers `CR0-CR7` are so called "control registers". They can be used to alter and control the processor's behaviour. `CR1`, as well as `CR5-CR7` are reserved, and trying to write them will result in an exception. By setting specific bits in the remaining registers `CR0`, as well as `CR2-CR4`, we can control the corresponding processor settings.

Register `CR4` is

> used in protected mode to control operations such as virtual-8086 support, enabling I/O breakpoints, page size extension and machine check exceptions. [^1]

While it is probably generally a good idea to not let random user space programs alter processor settings, `CR4` specifically may be dangerous because it is involved in virtualization and paging, which could lead to accessing other process' memory. Especially bit 7 looks very dangerous, as it enables global page translation. [^2]

[^1]: <https://en.wikipedia.org/wiki/Control_register#CR4>
[^2]: <http://developer.amd.com/wordpress/media/2012/10/24593_APM_v2.pdf>

## b
The segmentation fault occurs at the assembly instruction `mov %cr4, %rax`. This instruction tries to put the content of register `CR4` into register `RAX`.

## c
We were able to reproduce the hello world kernel module, and could see its output with `dmesg`.

## d
The kernel module runs in kernel space (ring 0), so we can access register `CR4` without a problem.
Putting the exact same assembly instruction in the kernel module did not result in a segmentation fault. We could successfully read and print register `CR4`.

To compile and use the module run

```
cd kernel_module
make
insmod kernel_module.ko
rmmod kernel_module.ko
dmesg | tail -2
```

You should see two messages from our module. One message is containing the value of register `CR4`, the other message informs us that the module was unloaded again.

# 2
## a
To run the attack, first of all we need to compile the vulnerable program:

```
cd rop
make
```

You can disable ASLR via `make disable-aslr`.

## b
## c
## d
