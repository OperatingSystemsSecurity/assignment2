#!/usr/bin/env bash

usage () {
	echo "usage: $0 <binary name>"
}

print_pointer () {
	printf '%016x\n' $1
}

[[ $# != 1 ]] && usage && exit 1

buffer_address=$(print_pointer $(echo | ./$1 | head -n1))
cat | ./$1 > /dev/null &
libc_base_address=$(print_pointer 0x$(grep libc- /proc/$(pidof $1)/maps | head -n1 | cut -d'-' -f1))
kill $(pidof $1)
libc_system=$(nm -D /usr/lib/libc.so.6 | grep "\<system\>" | cut -d' ' -f1)
libc_exit=$(nm -D /usr/lib/libc.so.6 | grep "\<exit\>" | cut -d' ' -f1)

if [[ $DEBUG ]]; then
	echo "Buffer address: $buffer_address"
	echo "Libc base address: $libc_base_address"
	echo "Libc system offset: $libc_system"
	echo "Libc exit offset: $libc_exit"
fi | column -t -s:
